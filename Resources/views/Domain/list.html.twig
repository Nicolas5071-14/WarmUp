{% extends '@MauticCore/Default/content.html.twig' %}

{% block mauticContent %}warmupDomain{% endblock %}

{% block headerTitle %}
    {{ 'mautic.warmup.domains'|trans }}
{% endblock %}

{% block actions %}
    {{ include('@MauticCore/Helper/page_actions.html.twig', {
        'templateButtons': {
            'new': permissions['plugin:warmup:domains:create']
        },
        'routeBase': 'warmup_domain',
        'langVar': 'warmup.domain'
    }) }}
{% endblock %}

{% block content %}
<div class="panel panel-default bdr-t-wdh-0 mb-0">
    <div class="panel-body">
        <div class="box-layout">
            <div class="row">
                <div class="col-xs-12 va-m">
                    {{ include('@MauticCore/Helper/list_toolbar.html.twig', {
                        'searchValue': searchValue,
                        'action': currentRoute,
                        'langVar': 'warmup.domain',
                        'routeBase': 'warmup_domain',
                        'templateButtons': {
                            'delete': permissions['plugin:warmup:domains:delete']
                        }
                    }) }}
                </div>
            </div>
        </div>
        
        <div class="page-list">
            <table class="table table-hover table-striped table-bordered domain-list" id="domainTable">
                <thead>
                    <tr>
                        <th class="col-domain-name">
                            {{ 'mautic.core.name'|trans }}
                        </th>
                        <th class="col-email-prefix">
                            {{ 'mautic.warmup.domain.email_prefix'|trans }}
                        </th>
                        <th class="col-daily-limit">
                            {{ 'mautic.warmup.domain.daily_limit'|trans }}
                        </th>
                        <th class="col-sent-today">
                            {{ 'mautic.warmup.domain.total_sent_today'|trans }}
                        </th>
                        <th class="col-status">
                            {{ 'mautic.core.status'|trans }}
                        </th>
                        <th class="col-actions">
                            {{ 'mautic.core.actions'|trans }}
                        </th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in items %}
                        <tr>
                            <td>
                                <div>
                                    {{ include('@MauticCore/Helper/name.html.twig', {
                                        'item': item,
                                        'query': 'id=' ~ item.id
                                    }) }}
                                </div>
                                <div class="small">
                                    {{ item.smtpHost }}:{{ item.smtpPort }}
                                </div>
                            </td>
                            <td>
                                {% if item.emailPrefix %}
                                    {{ item.emailPrefix }}@{{ item.domainName }}
                                {% else %}
                                    <em>{{ 'mautic.core.none'|trans }}</em>
                                {% endif %}
                            </td>
                            <td>
                                {{ item.dailyLimit }}
                            </td>
                            <td>
                                <span class="label label-{{ item.totalSentToday >= item.dailyLimit ? 'danger' : (item.totalSentToday > 0 ? 'warning' : 'success') }}">
                                    {{ item.totalSentToday }} / {{ item.dailyLimit }}
                                </span>
                            </td>
                            <td>
                                {% if item.isVerified %}
                                    <span class="label label-success" data-toggle="tooltip" title="{{ 'mautic.warmup.domain.is_verified'|trans }}">
                                        <i class="fa fa-check"></i> {{ 'mautic.warmup.domain.is_verified'|trans }}
                                    </span>
                                {% else %}
                                    <span class="label label-danger" data-toggle="tooltip" title="{{ 'mautic.warmup.domain.not_verified'|trans }}">
                                        <i class="fa fa-times"></i> {{ 'mautic.warmup.domain.not_verified'|trans }}
                                    </span>
                                {% endif %}
                                
                                {% if item.isActive %}
                                    <span class="label label-success" data-toggle="tooltip" title="{{ 'mautic.warmup.domain.is_active'|trans }}">
                                        <i class="fa fa-play"></i> {{ 'mautic.warmup.domain.is_active'|trans }}
                                    </span>
                                {% else %}
                                    <span class="label label-default" data-toggle="tooltip" title="{{ 'mautic.warmup.domain.not_active'|trans }}">
                                        <i class="fa fa-pause"></i> {{ 'mautic.warmup.domain.not_active'|trans }}
                                    </span>
                                {% endif %}
                            </td>
                            <td>
                                {{ include('@MauticCore/Helper/list_actions.html.twig', {
                                    'item': item,
                                    'templateButtons': {
                                        'edit': permissions['plugin:warmup:domains:edit'],
                                        'delete': permissions['plugin:warmup:domains:delete']
                                    },
                                    'routeBase': 'warmup_domain',
                                    'langVar': 'warmup.domain',
                                    'customButtons': [
                                        {
                                            'attr': {
                                                'data-toggle': 'ajax',
                                                'href': path('warmup_domain_verify', {'id': item.id})
                                            },
                                            'btnText': 'mautic.warmup.action.verify'|trans,
                                            'iconClass': 'fa fa-check',
                                            'btnClass': 'btn btn-xs btn-success',
                                            'priority': 200
                                        },
                                        {
                                            'attr': {
                                                'data-toggle': 'ajax',
                                                'href': path('warmup_domain_toggle', {'id': item.id})
                                            },
                                            'btnText': item.isActive ? 'mautic.warmup.action.pause'|trans : 'mautic.warmup.action.start'|trans,
                                            'iconClass': item.isActive ? 'fa fa-pause' : 'fa fa-play',
                                            'btnClass': item.isActive ? 'btn btn-xs btn-warning' : 'btn btn-xs btn-success',
                                            'priority': 100
                                        }
                                    ]
                                }) }}
                            </td>
                        </tr>
                    {% else %}
                        <tr>
                            <td colspan="6" class="text-center">
                                {{ 'mautic.warmup.domain.noitems'|trans }}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <div class="panel-footer">
            {{ include('@MauticCore/Helper/pagination.html.twig', {
                'totalItems': totalCount,
                'page': page,
                'limit': limit,
                'menuLinkId': 'warmup_domain_index',
                'baseUrl': path('warmup_domain_index'),
                'tmpl': tmpl
            }) }}
        </div>
    </div>
</div>
{% endblock %}

{% block extraScripts %}
<script>
    mauticLang['warmupConfirmDelete'] = '{{ 'mautic.warmup.domain.delete.confirm'|trans }}';
    
    Mautic.onPageLoad('#domainTable', function(container) {
        // Add any custom JavaScript for domain list
        container.find('[data-toggle="tooltip"]').tooltip();
    });
</script>
{% endblock %}
